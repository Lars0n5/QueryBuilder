# Класс DBWrapper на PHP

## Обзор

`DBWrapper` — это абстрактный PHP-класс, разработанный для упрощения взаимодействия с базой данных с использованием расширения PDO (PHP Data Objects). Он предоставляет интерфейс для построения и выполнения SQL-запросов, таких как `SELECT`, `INSERT`, `UPDATE` и `DELETE`. Этот класс предназначен для расширения путем создания конкретной реализации, которая определяет метод `connect()` для установления соединения с базой данных.

## Возможности

- **Флюентный интерфейс**: Методы, такие как `table()`, `select()`, `where()`, `limit()` и другие, возвращают сам экземпляр, что позволяет строить запросы с помощью цепочек методов.
- **Генерация SQL-запросов**: Автоматически генерирует SQL-запросы на основе вызовов методов.
- **Поддержка подготовленных выражений**: Использует подготовленные выражения для безопасного выполнения SQL-запросов, предотвращая SQL-инъекции.
- **Поддержка CRUD операций**: Поддерживает основные SQL-операции, включая `SELECT`, `INSERT`, `UPDATE` и `DELETE`.

## Структура класса

### Свойства

- **`$pdo`**: Содержит экземпляр PDO для подключения к базе данных.
- **`$query`**: Хранит строку SQL-запроса, который строится.
- **`$table`**: Имя таблицы для взаимодействия.
- **`$conditions`**: Массив условий `WHERE`.
- **`$fields`**: Указывает поля для выбора или изменения.
- **`$limit`**: Ограничивает количество возвращаемых или затрагиваемых строк.
- **`$orderBy`**: Определяет столбец и направление для сортировки результатов.

### Методы

#### `__construct($config)`
Инициализирует экземпляр `DBWrapper` и устанавливает соединение с базой данных, используя переданную конфигурацию.

#### `connect($config)`
Абстрактный метод, который должен быть реализован в подклассе для установления соединения с базой данных, используя переданную конфигурацию.

#### `table($table)`
Задает таблицу для запроса.

- **Параметры**: 
  - `$table` (строка): Имя таблицы.

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `insert($data)`
Генерирует `INSERT` запрос.

- **Параметры**: 
  - `$data` (массив): Ассоциативный массив пар "столбец-значение".

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `select($fields = "*")`
Генерирует `SELECT` запрос.

- **Параметры**: 
  - `$fields` (смешанный тип): Строка или массив полей для выбора (по умолчанию `*`).

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `where($field, $operator, $value)`
Добавляет условие `WHERE` к запросу.

- **Параметры**: 
  - `$field` (строка): Имя столбца.
  - `$operator` (строка): Оператор сравнения (например, `=`, `>`, `<`).
  - `$value` (смешанный тип): Значение для сравнения.

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `update($data)`
Генерирует `UPDATE` запрос.

- **Параметры**: 
  - `$data` (массив): Ассоциативный массив пар "столбец-значение".

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `delete()`
Генерирует `DELETE` запрос.

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `limit($limit)`
Добавляет `LIMIT` к запросу.

- **Параметры**: 
  - `$limit` (число): Максимальное количество возвращаемых или затрагиваемых строк.

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `orderBy($field, $direction = 'ASC')`
Добавляет `ORDER BY` к запросу.

- **Параметры**: 
  - `$field` (строка): Столбец для сортировки.
  - `$direction` (строка): Направление сортировки (`ASC` или `DESC`).

- **Возвращает**: 
  - `self`: Позволяет вызывать методы в цепочке.

#### `execute()`
Завершает построение и выполняет запрос.

- **Возвращает**: 
  - `PDOStatement`: Выполненный запрос.

## Использование

Для использования `DBWrapper` создайте подкласс, который реализует метод `connect()`. Пример:

```php
class MyDB extends DBWrapper {
    protected function connect($config) {
        $dsn = "mysql:host={$config['host']};dbname={$config['dbname']}";
        $this->pdo = new PDO($dsn, $config['username'], $config['password']);
    }
}

$config = [
    'host' => 'localhost',
    'dbname' => 'test_db',
    'username' => 'root',
    'password' => ''
];

$db = new MyDB($config);

$result = $db->table('users')
             ->select(['id', 'name'])
             ->where('id', '=', 1)
             ->execute()
             ->fetch(PDO::FETCH_ASSOC);

print_r($result);
